/*! ArcGIS API for JavaScript 4.8 | Copyright (c) 2018 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["dojo/_base/declare","dijit/_WidgetBase","Quoin/Handlebars","Quoin/HandlebarsTemplated","Quoin/Model","dojo/query","dojo/_base/event","dojo/_base/lang","dojo/_base/array","dojox/lang/functional/object","dojo/on","dojo/dom-style","dojo/topic","dojo/dom-construct","dojo/NodeList-dom"],function(t,i,e,n,s,a,r,l,o,h,c,d,u,g){return e.registerHelper("get",function(t,i){if(t.model&&t.model.get(i)){var e=t.model.get(i);return"string"==typeof e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}return""}),e.registerHelper("log",function(t){console.log("Handlebars Log :",t)}),e.registerHelper("node",function(t){return"data-dojo-attach-point="+t}),t("Quoin.View",[i,n],{_bindings:{},_watches:[],constructor:function(t){t&&t.model||(this.model=new s({}))},postCreate:function(){this._createEvents(),this._createBindings(),this.inherited(arguments)},destroy:function(){this._removeWatches(),this.inherited(arguments)},use:function(t){return this._removeWatches(),(this.model=t)&&(this._createBindings(),this._runBindings()),this},render:function(t,i,e){return e&&(this.destroyRendering(),this._rendered=!1,this.buildRendering(),this._createEvents(),this._createBindings(),this._runBindings()),g.place(this.domNode,t,i),this},_createEvents:function(){h.forIn(this.events,l.hitch(this,function(i,t){var e=t.split(" "),n=e.splice(-1,1)[0],s=e.join(" "),o=a(s,this.domNode),h=l.hitch(this,function(t){r.stop(t),l.hitch(this,this[i])(t)});o.length?this.own(c(o,n,h)):this.own(c(this.domNode,s+":"+n,h))}))},_runBindings:function(){h.forIn(this.bindings,l.hitch(this,function(t,i){var e,n;if(l.isObject(t)&&(e=t.callback,n=t.element),(l.isFunction(t)||e)&&(e?l.hitch(this,e||t):l.hitch(this,t))(this.model.get(i)),l.isString(t)||n){var s=n?n.split(" "):t.split(" "),o=s.splice(-1,1)[0],h=s.join(" ");a(h,this.domNode).attr(o,this.model.get(i))}}))},_removeWatches:function(){o.forEach(this._watches,function(t){t.unwatch()})},_createBindings:function(){h.forIn(this.bindings,l.hitch(this,function(t,i){var n,s,e,o;if(l.isObject(t)&&(e=t.callback,o=t.element),(l.isFunction(t)||e)&&(n=e?l.hitch(this,e):l.hitch(this,t)),l.isString(t)||o){var h=o?o.split(" "):t.split(" "),r=h.splice(-1,1)[0],c=h.join(" ");s=l.hitch(this,function(t){a(c,this.domNode).attr(r,t)})}var d=this.model.watch(i,l.hitch(this,function(t,i,e){s&&s(e),n&&n(e)}));this._watches.push(d)}))},subscribe:function(t,i){return this.own(u.subscribe(t,l.hitch(this,i)))},publish:function(){var t=Array.prototype.slice.call(arguments);u.publish.apply(this,t)}})});
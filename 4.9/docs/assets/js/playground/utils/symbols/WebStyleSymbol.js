/*! ArcGIS API for JavaScript 4.9 | Copyright (c) 2018 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["esri/config","esri/request","esri/core/HandleRegistry","esri-playground-js/utils/CurrentState","esri-playground-js/utils/CodeGenerator","dojo/dom","dojo/dom-construct"],function(l,s,e,n,f,d,m){var t={},u=new e;function r(r){var n;s(l.portalUrl+"/sharing/rest/portals/self?f=json").then(function(e){return s(l.portalUrl+"/sharing/rest/community/groups/",{query:{q:e.data.stylesGroupQuery,f:"json"}})}).then(function(e){return n=e.data.results[0].id,s(l.portalUrl+"/sharing/rest/search",{query:{q:"group: "+n,f:"json"}})}).then(function(e){var t=[];return e.data.results.forEach(function(e){t.push({name:e.title,value:"3d"===e.typeKeywords[0]?e.typeKeywords[2]:e.typeKeywords[1]})}),{groupId:n,styles:t}}).then(function(a){i(r,"styleName",a.styles);var e=r.statefulObject.watch("styleName",function(e,t,n){n&&(r.statefulObject.set("name",null),o(r,a.groupId,n))});u.add(e,"web-style-symbol-styleName-handler"),r.statefulObject.styleName&&o(r,a.groupId,r.statefulObject.styleName)})}function o(t,e,n){var a,r;(a=e,r=n,s(l.portalUrl+"/sharing/rest/search",{query:{q:"group: "+a+" AND typekeywords: "+r,f:"json"}}).then(function(e){return s(l.portalUrl+"/sharing/rest/content/items/"+e.data.results[0].id+"/data?f=json").then(function(e){return e.data.items.map(function(e){return{name:e.name,value:e.name}})})})).then(function(e){i(t,"name",e)})}function c(t,e){var n;(n=e,s(n+"?f=json").then(function(e){return e.data.items.map(function(e){return{name:e.name,value:e.name}})})).then(function(e){i(t,"name",e)})}function i(e,t,n){var a=e.config,r=f.getProperty(a,a.className,t);if(r){if(n){var l={type:"String",values:[]};n.forEach(function(e){l.values.push(e),r&&(r.options=l)})}else delete r.options;e.set("config",a);var s,u=r.domId+"-ID",o=d.byId(u),c=o.parentNode;if(m.destroy(o),n){(s=document.createElement("SELECT")).className="property-value",s.setAttribute("id",u),s.setAttribute("name",r.name);var i=document.createElement("option");i.innerHTML="select "+r.name,i.className="property-value",i.disabled=!0,i.selected=!0,i.style.background="#ecf0f1",s.appendChild(i),r.options.values.forEach(function(e){var t=document.createElement("option");t.innerHTML=e.name,t.setAttribute("value",e.value),s.appendChild(t)})}else(s=document.createElement("input")).className="property-value",s.setAttribute("id",u),s.setAttribute("type","text"),s.setAttribute("placeholder","enter "+r.name);c.appendChild(s),e.statefulObject[r.name]&&(s.value=e.statefulObject[r.name]),e.statefulObject.watch(r.name,function(e,t,n){s.value=n}),s.addEventListener("change",function(){e.statefulObject.set(r.name,s.value)},!1),n||(s.value=null,e.statefulObject.set(r.name,null))}}return t.init=function(){u.removeAll();var a=n.getInstance(),e=a.statefulObject.portal.watch("url",function(e,t,n){u.remove("web-style-symbol-styleName-handler"),n?(a.statefulObject.set("styleUrl",null),r(a)):(i(a,"styleName",null),i(a,"name",null))});u.add("web-style-symbol-portal-url-handler",e);var t=a.statefulObject.watch("styleUrl",function(e,t,n){n?(a.statefulObject.portal.set("url",null),c(a,n)):i(a,"name",null)});u.add(t,"web-style-symbol-styleUrl-handler"),a.statefulObject.portal.url||a.statefulObject.styleUrl||a.statefulObject.portal.set("url","https://www.arcgis.com"),a.statefulObject.portal.url&&r(a),a.statefulObject.styleUrl&&c(a,a.statefulObject.styleUrl)},t});
/*! ArcGIS API for JavaScript 4.9 | Copyright (c) 2018 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},throttle=function(a,r){var t=void 0,o=void 0,n=void 0;return function(){var e=this,s=arguments;t?(clearTimeout(o),o=setTimeout(function(){Date.now()-n>=r&&(a.apply(e,s),n=Date.now())},r-(Date.now()-n))):(a.apply(e,s),n=Date.now(),t=!0)}};function hasSearchResults(e){return!!e&&0<e.length}function processAPIReferenceSearchResults(o,n){return new Promise(function(e,s){if(o){var a=o.map(function(e){var s=n[e.ref];if(/\.html#/.test(s.page_url)){var a=/[-\w]*(?=$)/im;s.secondary_search_term=a.test(s.page_url)?s.page_url.match(a)[0]:s.class}else s.secondary_search_term=s.class;return s.tertiary_search_term=s.package+"/"+s.class,s}),r=/[-:.#\w]+(?=["']>)/i,t=a.map(function(e){var s=e.html.match(r);return e.muid=0<s.length?s[0]:e.html,e}).sort(function(e,s){return s.rank-e.rank||e.secondary_search_term.localeCompare(s.secondary_search_term)||e.tertiary_search_term.localeCompare(s.tertiary_search_term)});e({records:_.uniqBy(t,"muid")})}else e({records:[]})})}if("function"==typeof importScripts){var workerHref=self.location.href,baseURL=workerHref.replace(/\/lunr-worker\.js[-=?#&_~[\]@!"$'()*+.,;:\w\d]*/,"");self.importScripts(baseURL+"/libs/lunr.js",baseURL+"/api-reference-lunr.js",baseURL+"/sample-code-lunr.js",baseURL+"/libs/lodash.js"),"undefined"==typeof Promise&&(self.importScripts(baseURL+"/libs/es6-promise.js"),self.importScripts(baseURL+"/libs/es6-promise.auto.js"));var apiRefSerializedIndex=esriAPIReferenceLunrData.searchindex,apiRefSearchData=esriAPIReferenceLunrData.searchdata,apiRefSearchIndex=lunr.Index.load(apiRefSerializedIndex),isAPIReferenceSearchReady="string"==typeof apiRefSerializedIndex.version&&"object"===(void 0===apiRefSearchData?"undefined":_typeof(apiRefSearchData)),sampleCodeSerializedIndex=esriSampleCodeLunrData.searchindex,sampleCodeSearchData=esriSampleCodeLunrData.searchdata;lunr.tokenizer.separator=/[,s]+/;var sampleCodeSearchIndex=lunr.Index.load(sampleCodeSerializedIndex),isSampleCodeSearchReady="string"==typeof sampleCodeSerializedIndex.version&&"object"===(void 0===sampleCodeSearchData?"undefined":_typeof(sampleCodeSearchData)),readyMessage={type:"ready",sample_code_lunr_index_loaded:isSampleCodeSearchReady,api_reference_lunr_index_loaded:isAPIReferenceSearchReady},searchMilliSecondsDelay=500;onmessage=throttle(function(e){var s=50,a=!1,r=e.data,t={messageId:r.messageId,results:[],type:r.type};if("api-reference-search"===r.type){var o=void 0,n=r.value;if(t.value=n,/\*$/g.test(n))(a=hasSearchResults(o=apiRefSearchIndex.search(n)))?processAPIReferenceSearchResults(o,apiRefSearchData).then(function(e){t.results=e.records,postMessage(t)}):(t.results=[],postMessage(t));else{if(/(\w+\s)+\w+/g.test(n)&&!a){n=n.replace(/\s+/g,"*");try{var c=[],i=[],l=apiRefSearchIndex.search(n);l&&l.length<s&&(c=apiRefSearchIndex.search(n+"*")),l&&l.length<s&&c&&c.length<s&&(i=apiRefSearchIndex.search("*"+n+"*")),(a=hasSearchResults(o=l.concat(c,i)))?processAPIReferenceSearchResults(o,apiRefSearchData).then(function(e){t.results=e.records,postMessage(t)}):(t.results=[],postMessage(t))}catch(e){t.error=e,postMessage(t),console.log("worker - error: %s",e)}}if(!/\*/g.test(n)&&!/\s/g.test(n)&&!a)try{var p=[],d=[],h=apiRefSearchIndex.search(n);h&&h.length<s&&(p=apiRefSearchIndex.search(n+"*")),h&&h.length<s&&p&&p.length<s&&(d=apiRefSearchIndex.search("*"+n+"*")),(a=hasSearchResults(o=h.concat(p,d)))?processAPIReferenceSearchResults(o,apiRefSearchData).then(function(e){t.results=e.records,postMessage(t)}):(t.results=[],postMessage(t))}catch(e){t.error=e,postMessage(t),console.log("worker - error: %s",e)}if(!/\*/g.test(n)&&!a)try{o=apiRefSearchIndex.query(function(e){e.term(n,{usePipeline:!0,boost:50}),e.term(n+"*",{usePipeline:!1,boost:10}),e.term(n,{usePipeline:!1,editDistance:2,boost:1})}),a?processAPIReferenceSearchResults(o,apiRefSearchData).then(function(e){t.results=e.records,postMessage(t)}):(t.results=[],postMessage(t))}catch(e){t.error=e,postMessage(t),console.log("worker - error: %s",e)}}}else if("sample-code-search"===r.type){var f=void 0,u=r.value,m={title:[],tags:[]};if(t.value=u,/(\s|\*$)/.test(u))f=sampleCodeSearchIndex.search(u);else if(/\d\.\d/.test(u))f=sampleCodeSearchIndex.search(u);else try{f=sampleCodeSearchIndex.query(function(e){e.term(u,{usePipeline:!0,boost:50}),e.term(u+"*",{usePipeline:!1,boost:10}),e.term(u,{usePipeline:!1,editDistance:2,boost:1})})}catch(e){t.error=e,postMessage(t),console.log("Error: %s",e)}var S=[];Object.keys(f).forEach(function(e){var r=f[e].matchData.metadata,t=sampleCodeSearchData[f[e].ref],s=sampleCodeSearchData[f[e].ref],a=!(void 0!==s.is_external_sample&&!s.is_external_sample),o=!(void 0!==s.sandbox&&!s.sandbox),n=!(void 0!==s.jsshare&&!s.jsshare);Object.keys(r).forEach(function(a){Object.keys(r[a]).forEach(function(e){if(r[a][e]){var s=r[a][e].position;t[e]&&m[e].push(t[e].substr(s[0][0],s[0][1]))}})}),S.push({result:t,pageMeta:s,isExternalSample:a,sandboxEnabled:o,jsShareEnabled:n})}),t.results=S,t.matchTags=m,postMessage(t)}else console.log("Posting message back to main script"),postMessage(t)},searchMilliSecondsDelay),self.postMessage(readyMessage)}else console.log("worker - importScripts is undefined");